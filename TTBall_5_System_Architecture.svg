<?xml version="1.0" encoding="UTF-8"?>
<svg width="1200" height="900" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <linearGradient id="containerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#2196F3;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#1976D2;stop-opacity:0.9" />
    </linearGradient>
    <linearGradient id="serviceGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4CAF50;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#388E3C;stop-opacity:0.9" />
    </linearGradient>
    <linearGradient id="databaseGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#FF9800;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#F57C00;stop-opacity:0.9" />
    </linearGradient>
    <linearGradient id="aiGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#9C27B0;stop-opacity:0.8" />
      <stop offset="100%" style="stop-color:#7B1FA2;stop-opacity:0.9" />
    </linearGradient>
    <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
      <feDropShadow dx="3" dy="3" stdDeviation="3" flood-color="#000000" flood-opacity="0.3"/>
    </filter>
  </defs>
  
  <!-- Background -->
  <rect width="1200" height="900" fill="#f5f5f5"/>
  
  <!-- Title -->
  <text x="600" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#333">
    TTBall_5 AI System Architecture
  </text>
  
  <!-- Docker Container -->
  <rect x="50" y="60" width="1100" height="800" rx="15" fill="url(#containerGradient)" stroke="#1565C0" stroke-width="3" filter="url(#shadow)"/>
  <text x="70" y="85" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="white">
    üê≥ Docker Container: ttball5-ai-service
  </text>
  <text x="70" y="105" font-family="Arial, sans-serif" font-size="12" fill="white">
    Port: 8005 | Runtime: NVIDIA GPU | CUDA Enabled
  </text>
  
  <!-- FastAPI Application -->
  <rect x="100" y="130" width="300" height="200" rx="10" fill="url(#serviceGradient)" stroke="#2E7D32" stroke-width="2" filter="url(#shadow)"/>
  <text x="250" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    üöÄ FastAPI Application
  </text>
  <text x="120" y="180" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ main.py - Entry Point
  </text>
  <text x="120" y="200" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ /analyze - Video Analysis
  </text>
  <text x="120" y="220" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ /detect - Object Detection
  </text>
  <text x="120" y="240" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ /health - Health Check
  </text>
  <text x="120" y="260" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ /analytics - Dashboard
  </text>
  <text x="120" y="280" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ /analyze-breakthrough
  </text>
  <text x="120" y="300" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ Batch Processing
  </text>
  
  <!-- Core Components -->
  <rect x="450" y="130" width="280" height="120" rx="10" fill="#E3F2FD" stroke="#1976D2" stroke-width="2" filter="url(#shadow)"/>
  <text x="590" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1976D2">
    üîß Core Components
  </text>
  <text x="470" y="180" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ config.py - Settings Management
  </text>
  <text x="470" y="200" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ dependencies.py - DI Container
  </text>
  <text x="470" y="220" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ logging.py - Logging System
  </text>
  
  <!-- AI Models -->
  <rect x="780" y="130" width="320" height="200" rx="10" fill="url(#aiGradient)" stroke="#6A1B9A" stroke-width="2" filter="url(#shadow)"/>
  <text x="940" y="155" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    ü§ñ AI Models
  </text>
  <text x="800" y="180" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ YOLO11 - Object Detection
  </text>
  <text x="800" y="200" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ Gemma 3N - Multimodal Analysis
  </text>
  <text x="800" y="220" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ Model Manager - GPU/CPU Fallback
  </text>
  <text x="800" y="240" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ Subprocess Isolation
  </text>
  <text x="800" y="260" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ Dynamic Memory Allocation
  </text>
  <text x="800" y="280" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ Real-time Monitoring
  </text>
  <text x="800" y="300" font-family="Arial, sans-serif" font-size="11" fill="white">
    ‚Ä¢ 100% Detection Rate (Breakthrough)
  </text>
  
  <!-- Services Layer -->
  <rect x="100" y="370" width="600" height="200" rx="10" fill="#F3E5F5" stroke="#7B1FA2" stroke-width="2" filter="url(#shadow)"/>
  <text x="400" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#7B1FA2">
    ‚öôÔ∏è Services Layer
  </text>
  
  <!-- Analysis Service -->
  <rect x="120" y="410" width="170" height="140" rx="8" fill="url(#serviceGradient)" stroke="#2E7D32" stroke-width="1"/>
  <text x="205" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    Analysis Service
  </text>
  <text x="130" y="450" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Job Orchestration
  </text>
  <text x="130" y="470" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Progress Tracking
  </text>
  <text x="130" y="490" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Async Processing
  </text>
  <text x="130" y="510" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Background Tasks
  </text>
  <text x="130" y="530" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ VisionCraft Patterns
  </text>
  
  <!-- Video Processor -->
  <rect x="310" y="410" width="170" height="140" rx="8" fill="url(#serviceGradient)" stroke="#2E7D32" stroke-width="1"/>
  <text x="395" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    Video Processor
  </text>
  <text x="320" y="450" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Frame Extraction
  </text>
  <text x="320" y="470" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Video Analysis
  </text>
  <text x="320" y="490" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Trajectory Mapping
  </text>
  <text x="320" y="510" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Temporal Analysis
  </text>
  <text x="320" y="530" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Multi-format Support
  </text>
  
  <!-- Anomaly Service -->
  <rect x="500" y="410" width="180" height="140" rx="8" fill="url(#serviceGradient)" stroke="#2E7D32" stroke-width="1"/>
  <text x="590" y="430" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    Anomaly Service
  </text>
  <text x="510" y="450" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Physics Validation
  </text>
  <text x="510" y="470" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Bounce Detection
  </text>
  <text x="510" y="490" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Trajectory Continuity
  </text>
  <text x="510" y="510" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Ball Interpolation
  </text>
  <text x="510" y="530" font-family="Arial, sans-serif" font-size="10" fill="white">
    ‚Ä¢ Confidence Analysis
  </text>
  
  <!-- Breakthrough Detection -->
  <rect x="750" y="370" width="320" height="120" rx="10" fill="#E8F5E8" stroke="#4CAF50" stroke-width="2" filter="url(#shadow)"/>
  <text x="910" y="395" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#2E7D32">
    üéØ Breakthrough Detection (Phase 2)
  </text>
  <text x="770" y="420" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ 100% Ball Detection Rate
  </text>
  <text x="770" y="440" font-family="Arial, sans-serif" font-size="11" fill="333">
    ‚Ä¢ Enhanced Prompt System
  </text>
  <text x="770" y="460" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ Structured Multimodal Analysis
  </text>
  
  <!-- Database Layer -->
  <rect x="100" y="610" width="500" height="200" rx="10" fill="url(#databaseGradient)" stroke="#E65100" stroke-width="2" filter="url(#shadow)"/>
  <text x="350" y="635" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">
    üóÑÔ∏è DuckDB Database (/app/results/ttball_new.duckdb)
  </text>
  
  <!-- Database Tables -->
  <rect x="120" y="650" width="140" height="140" rx="8" fill="#FFF3E0" stroke="#F57C00" stroke-width="1"/>
  <text x="190" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#E65100">
    Tables
  </text>
  <text x="130" y="690" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ video_metadata
  </text>
  <text x="130" y="710" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ frame_analysis
  </text>
  <text x="130" y="730" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ gemma_analysis
  </text>
  <text x="130" y="750" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ anomaly_analysis
  </text>
  <text x="130" y="770" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ bounce_events
  </text>
  
  <!-- Data Storage -->
  <rect x="280" y="650" width="140" height="140" rx="8" fill="#FFF3E0" stroke="#F57C00" stroke-width="1"/>
  <text x="350" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#E65100">
    Storage
  </text>
  <text x="290" y="690" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ Video Files
  </text>
  <text x="290" y="710" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ Analysis Results
  </text>
  <text x="290" y="730" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ Trajectory Data
  </text>
  <text x="290" y="750" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ Anomaly Scores
  </text>
  <text x="290" y="770" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ Confidence Metrics
  </text>
  
  <!-- Analytics -->
  <rect x="440" y="650" width="140" height="140" rx="8" fill="#FFF3E0" stroke="#F57C00" stroke-width="1"/>
  <text x="510" y="670" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#E65100">
    Analytics
  </text>
  <text x="450" y="690" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ Detection Stats
  </text>
  <text x="450" y="710" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ Performance Metrics
  </text>
  <text x="450" y="730" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ Export Capabilities
  </text>
  <text x="450" y="750" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ Real-time Dashboard
  </text>
  <text x="450" y="770" font-family="Arial, sans-serif" font-size="10" fill="#333">
    ‚Ä¢ Visualization
  </text>
  
  <!-- Frontend Dashboard -->
  <rect x="650" y="610" width="420" height="200" rx="10" fill="#E1F5FE" stroke="#0277BD" stroke-width="2" filter="url(#shadow)"/>
  <text x="860" y="635" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#01579B">
    üìä Analytics Dashboard (Phase 3)
  </text>
  <text x="670" y="660" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ Real-time Video Analysis Visualization
  </text>
  <text x="670" y="680" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ Ball Trajectory Mapping & Confidence Charts
  </text>
  <text x="670" y="700" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ Detection Statistics & Performance Metrics
  </text>
  <text x="670" y="720" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ Anomaly Analysis Reports
  </text>
  <text x="670" y="740" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ Export Functionality (JSON/CSV)
  </text>
  <text x="670" y="760" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ Interactive Data Exploration
  </text>
  <text x="670" y="780" font-family="Arial, sans-serif" font-size="11" fill="#333">
    ‚Ä¢ Port: 3005 (Frontend Container)
  </text>
  
  <!-- Data Flow Arrows -->
  <!-- FastAPI to Services -->
  <path d="M 400 230 L 450 230" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- Services to AI Models -->
  <path d="M 700 280 L 780 280" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- Services to Database -->
  <path d="M 400 570 L 400 610" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- Database to Dashboard -->
  <path d="M 600 710 L 650 710" stroke="#666" stroke-width="2" marker-end="url(#arrowhead)" fill="none"/>
  
  <!-- Arrow marker definition -->
  <defs>
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>
  
  <!-- System Status -->
  <rect x="50" y="870" width="200" height="25" rx="5" fill="#4CAF50" stroke="#2E7D32" stroke-width="1"/>
  <text x="150" y="887" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">
    ‚úÖ System Status: OPERATIONAL
  </text>
  
  <!-- Performance Metrics -->
  <text x="300" y="887" font-family="Arial, sans-serif" font-size="12" fill="#333">
    üéØ Detection Rate: 100% | ü§ñ AI Confidence: 94.8% | üìä Videos Processed: 4
  </text>
  
</svg>
